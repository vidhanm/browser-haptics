<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haptic Video Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        video {
            width: 100%;
            height: auto;
            display: block;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(238, 90, 82, 0.3);
            flex: 1;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(238, 90, 82, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            box-shadow: 0 4px 15px rgba(68, 160, 141, 0.3);
        }

        .btn.secondary:hover {
            box-shadow: 0 6px 20px rgba(68, 160, 141, 0.4);
        }

        .status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-item {
            color: white;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-value {
            font-weight: 600;
            color: #4ecdc4;
        }

        .haptic-timeline {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            max-height: 150px;
            overflow-y: auto;
        }

        .haptic-timeline h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .haptic-event {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            color: white;
            font-size: 0.9em;
        }

        .intensity-control {
            margin: 20px 0;
        }

        .intensity-control label {
            color: white;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
            border: none;
        }

        .warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            color: #fff3cd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé¨ Haptic Video Player</h1>
        
        <div class="warning">
            üì± For best experience, use this on a mobile device with vibration support. Desktop browsers have limited haptic feedback capabilities.
        </div>

        <div class="video-container">
            <video id="hapticVideo" controls preload="metadata">
                <source src="./f1-video.mp4" type="video/mp4">
                <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                <p>Your browser doesn't support HTML5 video. Here is a <a href="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">link to the video</a> instead.</p>
            </video>
        </div>

        <div class="controls">
            <button class="btn" id="playBtn">‚ñ∂Ô∏è Play with Haptics</button>
            <button class="btn secondary" id="testBtn">üîÑ Test Vibration</button>
        </div>

        <div class="intensity-control">
            <label for="intensitySlider">Haptic Intensity: <span id="intensityValue">100%</span></label>
            <input type="range" id="intensitySlider" class="slider" min="0" max="100" value="100">
        </div>

        <div class="status">
            <div class="status-item">
                <span>Vibration Support:</span>
                <span class="status-value" id="vibrationSupport">Checking...</span>
            </div>
            <div class="status-item">
                <span>Current Time:</span>
                <span class="status-value" id="currentTime">0:00</span>
            </div>
            <div class="status-item">
                <span>Haptic Events:</span>
                <span class="status-value" id="hapticCount">0 events loaded</span>
            </div>
        </div>

        <div class="haptic-timeline" id="hapticTimelineContainer">
            <h3>üèéÔ∏è F1 Haptic Timeline</h3>
            <!-- Timeline events will be populated by JavaScript -->
        </div>
    </div>

    <script>
        class HapticVideoPlayer {
            constructor() {
                this.video = document.getElementById('hapticVideo');
                this.playBtn = document.getElementById('playBtn');
                this.testBtn = document.getElementById('testBtn');
                this.intensitySlider = document.getElementById('intensitySlider');
                this.intensityValue = document.getElementById('intensityValue');
                this.currentTimeDisplay = document.getElementById('currentTime');
                this.hapticCountDisplay = document.getElementById('hapticCount');
                this.timelineContainer = document.getElementById('hapticTimelineContainer');
                
                this.hapticEnabled = false;
                this.intensity = 1.0;
                this.lastHapticTime = -1; // Use -1 to ensure the first event triggers
                this.backgroundHapticInterval = null; // Manages the looping RPM vibration

                // Define different patterns for background RPM feel
                this.rpmPatterns = {
                    low: [10, 120],      // A light, infrequent pulse for low speeds/revs
                    high: [30, 60],     // A faster, more intense buzz for high speeds/straights
                    cornering: [40, 80] // A slightly rougher feel for G-force in corners
                };

                this.hapticEvents = 
                [
    {
        "time": 0.0,
        "pattern": [
            117
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 0.25,
        "pattern": [
            78
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 0.5,
        "pattern": [
            130
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 0.75,
        "pattern": [
            166
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 1.0,
        "pattern": [
            199
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 1.25,
        "pattern": [
            205
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 1.5,
        "pattern": [
            201
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 1.75,
        "pattern": [
            191
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 2.0,
        "pattern": [
            155
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 2.25,
        "pattern": [
            173
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 2.5,
        "pattern": [
            167
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 2.75,
        "pattern": [
            191
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 3.0,
        "pattern": [
            193
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 3.25,
        "pattern": [
            189
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 3.5,
        "pattern": [
            184
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 3.75,
        "pattern": [
            184
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 4.0,
        "pattern": [
            188
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 4.25,
        "pattern": [
            199
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 4.5,
        "pattern": [
            204
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 4.75,
        "pattern": [
            206
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 5.0,
        "pattern": [
            211
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 5.25,
        "pattern": [
            209
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 5.5,
        "pattern": [
            203
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 5.75,
        "pattern": [
            203
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 6.0,
        "pattern": [
            200
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 6.25,
        "pattern": [
            199
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 6.5,
        "pattern": [
            199
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 6.75,
        "pattern": [
            183
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 7.0,
        "pattern": [
            201
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 7.25,
        "pattern": [
            191
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 7.5,
        "pattern": [
            186
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 7.75,
        "pattern": [
            187
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 8.0,
        "pattern": [
            196
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 8.25,
        "pattern": [
            178
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 8.5,
        "pattern": [
            178
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 8.75,
        "pattern": [
            170
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 9.0,
        "pattern": [
            176
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 9.25,
        "pattern": [
            168
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 9.5,
        "pattern": [
            173
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 9.75,
        "pattern": [
            170
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 10.0,
        "pattern": [
            168
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 10.25,
        "pattern": [
            160
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 10.5,
        "pattern": [
            155
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 10.75,
        "pattern": [
            183
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 11.0,
        "pattern": [
            179
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 11.25,
        "pattern": [
            172
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 11.5,
        "pattern": [
            172
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 11.75,
        "pattern": [
            170
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 12.0,
        "pattern": [
            176
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 12.25,
        "pattern": [
            185
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 12.5,
        "pattern": [
            185
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 12.75,
        "pattern": [
            189
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 13.0,
        "pattern": [
            191
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 13.25,
        "pattern": [
            189
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 13.5,
        "pattern": [
            191
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 13.75,
        "pattern": [
            190
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 14.0,
        "pattern": [
            205
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 14.25,
        "pattern": [
            185
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 14.5,
        "pattern": [
            172
        ],
        "description": "Base vibration (RPM+energy)"
    },
    {
        "time": 14.75,
        "pattern": [
            178
        ],
        "description": "Base vibration (RPM+energy)"
    },
        
       
            ];
                
                this.init();
            }
            
            init() {
                this.checkVibrationSupport();
                this.setupEventListeners();
                this.updateIntensityDisplay();
                this.populateTimeline();
            }

            populateTimeline() {
                // Clear existing timeline children except the title
                while (this.timelineContainer.children.length > 1) {
                    this.timelineContainer.removeChild(this.timelineContainer.lastChild);
                }

                this.hapticEvents.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'haptic-event';
                    const minutes = Math.floor(event.time / 60);
                    const seconds = (event.time % 60).toFixed(1);
                    eventDiv.textContent = `${minutes}:${seconds.padStart(4, '0')} - ${event.description}`;
                    this.timelineContainer.appendChild(eventDiv);
                });
                this.hapticCountDisplay.textContent = `${this.hapticEvents.length} F1 events loaded`;
            }

            startBackgroundHaptics(pattern) {
                if (this.backgroundHapticInterval) {
                    clearInterval(this.backgroundHapticInterval);
                }

                const loopVibration = () => {
                    if (this.video.paused) {
                        this.stopBackgroundHaptics();
                        return;
                    }
                    const scaledPattern = pattern.map(d => Math.round(d * this.intensity));
                    this.vibrate(scaledPattern);
                };
                
                const intervalDuration = pattern.reduce((a, b) => a + b, 0);
                if (intervalDuration > 0) {
                   this.backgroundHapticInterval = setInterval(loopVibration, intervalDuration);
                }
            }

            stopBackgroundHaptics() {
                clearInterval(this.backgroundHapticInterval);
                this.backgroundHapticInterval = null;
                if ('vibrate' in navigator) {
                    navigator.vibrate(0);
                }
            }
            
            checkVibrationSupport() {
                const vibrationSupport = document.getElementById('vibrationSupport');
                if ('vibrate' in navigator) {
                    vibrationSupport.textContent = '‚úÖ Supported';
                    vibrationSupport.style.color = '#4ecdc4';
                } else {
                    vibrationSupport.textContent = '‚ùå Not Supported';
                    vibrationSupport.style.color = '#ff6b6b';
                }
            }
            
            setupEventListeners() {
                this.playBtn.addEventListener('click', () => {
                    if (this.video.paused) {
                        this.hapticEnabled = true;
                        this.video.play();
                        this.playBtn.textContent = '‚è∏Ô∏è Pause';
                        this.startBackgroundHaptics(this.rpmPatterns.low);
                    } else {
                        this.video.pause();
                    }
                });
                
                this.testBtn.addEventListener('click', () => {
                    this.vibrate([200, 100, 200, 100, 400]);
                });
                
                this.video.addEventListener('timeupdate', () => {
                    this.updateTime();
                    if (this.hapticEnabled) {
                        this.checkHapticEvents();
                    }
                });
                
                this.video.addEventListener('ended', () => {
                    this.hapticEnabled = false;
                    this.playBtn.textContent = '‚ñ∂Ô∏è Play with Haptics';
                    this.stopBackgroundHaptics();
                });
                
                this.video.addEventListener('pause', () => {
                    this.hapticEnabled = false;
                    this.playBtn.textContent = '‚ñ∂Ô∏è Play with Haptics';
                    this.stopBackgroundHaptics();
                });
                
                this.intensitySlider.addEventListener('input', (e) => {
                    this.intensity = parseInt(e.target.value) / 100;
                    this.updateIntensityDisplay();
                });
            }
            
            updateIntensityDisplay() {
                const percentage = Math.round(this.intensity * 100);
                this.intensityValue.textContent = `${percentage}%`;
            }
            
            updateTime() {
                const currentTime = this.video.currentTime;
                const minutes = Math.floor(currentTime / 60);
                const seconds = Math.floor(currentTime % 60);
                this.currentTimeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            checkHapticEvents() {
                const currentTime = this.video.currentTime;
                
                this.hapticEvents.forEach(event => {
                    if (currentTime >= event.time && this.lastHapticTime < event.time) {
                        this.triggerHaptic(event);
                        this.lastHapticTime = event.time;
                    }
                });
            }
            
            triggerHaptic(event) {
                console.log(`Triggering haptic: ${event.description} at ${event.time}s`);
                
                this.stopBackgroundHaptics();

                const scaledPattern = event.pattern.map(duration => 
                    Math.round(duration * this.intensity)
                );
                
                this.vibrate(scaledPattern);
                this.showHapticFeedback(event.description);
                
                const patternDuration = scaledPattern.reduce((a, b) => a + b, 0);

                setTimeout(() => {
                    if (this.video.paused) return; // Don't restart if video has been paused

                    let nextPattern = this.rpmPatterns.low; // Default
                    if (event.description.toLowerCase().includes("acceleration") || event.description.toLowerCase().includes("straight")) {
                        nextPattern = this.rpmPatterns.high;
                    } else if (event.description.toLowerCase().includes("corner") || event.description.toLowerCase().includes("g-force")) {
                        nextPattern = this.rpmPatterns.cornering;
                    }
                    this.startBackgroundHaptics(nextPattern);
                }, patternDuration);
            }
            
            vibrate(pattern) {
                if ('vibrate' in navigator && this.intensity > 0) {
                    navigator.vibrate(pattern);
                }
            }
            
            showHapticFeedback(description) {
                const feedback = document.createElement('div');
                feedback.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(78, 205, 196, 0.9);
                    color: white;
                    padding: 10px 15px;
                    border-radius: 25px;
                    font-size: 14px;
                    font-weight: 600;
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                    text-align: center;
                `;
                feedback.textContent = `‚ö° ${description}`;
                
                if (!document.querySelector('#haptic-animation-styles')) {
                    const style = document.createElement('style');
                    style.id = 'haptic-animation-styles';
                    style.textContent = `
                        @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
                        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(120%); opacity: 0; } }
                    `;
                    document.head.appendChild(style);
                }
                
                document.body.appendChild(feedback);
                
                setTimeout(() => {
                    feedback.style.animation = 'slideOut 0.3s ease forwards';
                    feedback.addEventListener('animationend', () => feedback.remove());
                }, 2000);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            new HapticVideoPlayer();
        });
        
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('btn') && 'vibrate' in navigator) {
                navigator.vibrate(50);
            }
        });
    </script>
</body>
</html>